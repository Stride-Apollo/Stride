# Some advice on this configuration was taken from:
# https://genbattle.bitbucket.io/blog/2016/01/17/c++-travis-ci/?

# TODO specify exact versions on which it has to work

# Generic language, because we prefer to handle C++ configuration ourselves
language: generic

dist: trusty

addons:
  apt:
    sources: &sources
      - ubuntu-toolchain-r-test
    packages: &deps
      - libboost-all-dev
      - libhdf5-serial-dev

gcc_addons: &gcc_addons
    apt:
        sources:
            - *sources
        packages:
            - *deps
            - gcc-5
            - g++-5

clang_addons: &clang_addons
    apt:
        sources:
            - *sources
        packages:
            - *deps
            - clang-3.8
        

matrix:
  include:
  
    # Unit tests ......................
    
    - addons: *gcc_addons
      env: 
        - compiler='gcc'
        - test='unit'
        - unipar='dummy'
      
    - addons: *clang_addons
      env: 
        - compiler='clang'
        - test='unit'
        - unipar='dummy'
    
    - addons: *gcc_addons
      env: 
        - compiler='gcc'
        - test='unit'
        - unipar='TBB'
      
    - addons: *clang_addons
      env: 
        - compiler='clang'
        - test='unit'
        - unipar='TBB'
    
    - addons: *gcc_addons
      env: 
        - compiler='gcc'
        - test='unit'
        - unipar='OpenMP'
      
    - addons: *clang_addons
      env: 
        - compiler='clang'
        - test='unit'
        - unipar='OpenMP'
    
    # Scenario tests ..................
    
    - addons: *gcc_addons
      env: 
        - compiler='gcc'
        - test='scenarios'
        - unipar='dummy'
      
    - addons: *clang_addons
      env: 
        - compiler='clang'
        - test='scenarios'
        - unipar='dummy'
    
    - addons: *gcc_addons
      env: 
        - compiler='gcc'
        - test='scenarios'
        - unipar='TBB'
      
    - addons: *clang_addons
      env: 
        - compiler='clang'
        - test='scenarios'
        - unipar='TBB'
    
    - addons: *gcc_addons
      env: 
        - compiler='gcc'
        - test='scenarios'
        - unipar='OpenMP'
      
    - addons: *clang_addons
      env: 
        - compiler='clang'
        - test='scenarios'
        - unipar='OpenMP'


before_install:
  - ./travis/before_install.sh
  - PARALLEL_MAKE=2 make install

script:
  - ./travis/script.sh

notifications:
  slack: 
    rooms:
      - apollo-stride:u6J7UHJdtlvVNtnUjyRndtgh#repo
    on_failure: always
    on_success: change
  email: false
